---
layout: post
title: Read and write hdf5 files
tags: [python]
---

[HDF5 files](https://portal.hdfgroup.org/display/support/Documentation) are packed efficiently and allow to speed up calculations when dealing large quantities of data.

[HDF5 files](https://portal.hdfgroup.org/display/support/Documentation) can be quickly explored with the line commands [h5ls](https://support.hdfgroup.org/HDF5/Tutor/cmdtoolview.html#h5ls) and [h5dump](https://support.hdfgroup.org/HDF5/Tutor/cmdtoolview.html#h5dump).

[HDF5 files](https://portal.hdfgroup.org/display/support/Documentation) can be handled in many programming languages, but here I will focus on dealing with them with [`python`](https://www.python.org/).

### Opening a hdf5 file in python

[`Python`](https://www.python.org/) can handle [HDF5 files](https://portal.hdfgroup.org/display/support/Documentation) using the [h5py librery](https://www.h5py.org/). Thus the first step is to import this library and then define an object that will contain the information from our file:

```
import h5py
infile = 'myfile.hdf5'
f = h5py.File(infile, 'r') 
```

Usually, [HDF5 files](https://portal.hdfgroup.org/display/support/Documentation) contain a Header and the different types of data stored in different [groups](https://docs.h5py.org/en/stable/high/group.html), which are similar to folders. 

### Reading a hdf5 file in python

Let's assume that our file has the groups *Header* and *Data*. We can access the information in this groups by either defining new variables or including the name of the group as a path (we see this later).

```
header = f['Header']
data = f['Data']
```

#### Reading the information in the header

To list of attributes in a group, such the *Header*:

```
print(list(header.attrs.items()))  
```

Once we know the names of the attributes, we can access their values. Let's assume that one of the attributes is *BoxSize* and that we want to use this to get a volume:

```
volume = header.attrs['BoxSize']**3
```

#### Reading the data

Let's assume that in our *Data* group we have stored an array with the mass, *Mass*, and a matrix with positions, *Position* (with x, y, z), we can store these as numpy arrays doing the following:

```
mass = data['Mass'][:]
pos = data['Position'][:]
```

or

```
mass = f['Data/Mass'][:]
pos = f['Data/Position'][:]
```

Note that *mass* will be a numpy array and pos a matrix.

Instead of getting all the information within *Mass*, we could have only read the entries from 5 to 10, by doing:

```
mass5 = f['Data/Mass'][5:10]
```

### Writing an hdf5 file in python

We can create an output [HDF5 file](https://portal.hdfgroup.org/display/support/Documentation) using the write clause:

```
outfile = 'myoutput.hdf5'
hf = h5py.File(outfile, 'w')
```

This file is also going to have a header and a data group:

```
# Header
head = hf.create_dataset('header',(100,))	
head.attrs[u'volume']       = volume
head.attrs[u'units_volume'] = u'(Mpc/h)**3'

# Output data
hfdat = hf.create_group('data')
hfdat.create_dataset('mass',data=mass5)
hfdat['mass'].dims[0].label = 'Mass (Msun/h)'
```